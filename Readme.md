# Personal Site
The code behind my personal site.

It consists of a node.js server running express to render a frontend packaged by webpack. Server side rendering is used to support site indexers. Portfolio data is indexed and cached using MongoDB.

## How to run
If for whatever ~~odd~~ reason you want to use my portfolio engine, you can start by opening a terminal in the project root and using `npm install`. Make sure a mongodb server is set up accessible from 	`localhost:27017/personalwebsite`. You can do this by making sure mongod is in your path and running `mongod --dbpath path/to/personalwebsite.`

### Commands
The following are the supported npm commands. A command can be executed by running `npm run <nameofcommand>`. 
- **build-dev**: (*Development*) Executes webpack to compile the contents of assets/src, and dumps the results in assets/build. It watches for changes and recompiles if that's the case.
- **debug**: (*Development*) Runs the server, but opens the debugger on a separate port
- **start**: (*Production*) Runs the server to begin serving files.
- **build**: (*Production*) Executes webpack to compile the contents of assets/src, and dumps the results in assets/build.  
- **portfolio *env***: (*All*) Indexes the portfolio data. The argument *env* dictates which subfolder of portfolio_data to import. Building the portfolio needs to be done every time data is changed. MongoDB needs to be installed in order for it to work.

### Running in Development mode
First build the portfolio for dev mode by running `npm run portfolio development`. Afterwards , build-dev and debug need to be running in two separate terminal windows. Have two terminals open and use `npm run build-dev` in one to build assets and `npm run start` in the other to run the express server.

Afterwards open a web browser at `127.0.0.1:5000` to view it in all its glory.

## Structure

The application uses capistrano to deploy the contents to a remote server. The folder structure is as follows:
```
├─ cap/ 
|  └─ (contains capistrano deployment settings)
├─ portfolio_data/
|  ├─ dev/    (files with portfolio content)
|  └─ prod/   (production portfolio content)
├─ assets/
|  ├─ build/  (generated by webpack)
|  ├─ src/    (used by webpack to generate the build)
|  └─ static/ (static assets piped straight through)
├─ server/
|  ├─ templates/ (html templates used by express+nunjucks)
|  ├─ portfolio/ (code driving the portfolio system)
|  ├─ index.ts   (loads modules and starts up the server)
|  └─ (everything else)
├─ apiclient/
|  └─ (code used by server and assets to retrieve data to the server)
├─ shared/  (shared code to store any additional utilities)
|  └─ slug.ts/   (simple vanity url parsing)
└─ (package.json, webpack, and any other configs) 
```
Webpack builds the contents of assets/src/ and deposits it into assets/build/. Afterwards, those assets can be accessed from the server under /assets/build/. Static assets are not processed by webpack and can be accessed from /assets/static.

Both the server and client use the api client. The server uses it to load data for server side rendering. Reusing the api in the server makes it easier to ensure that results are equivalent on both server and client renders. 

# TODO

The portfolio isn't finished yet.

- Handle images in articles when viewed on mobile (thinking click to zoom? Scrollbar on just image?)
- Improve styling for articles
- Link production portfolio data to a seperate repository instead of development
- Clean up the old javascript still there from the original portfolio
